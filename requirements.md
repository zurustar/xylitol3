# ソフトウェア要件定義書

## 1. 概要

本ドキュメントは、Go言語で実装されたSIPサーバーの機能要件および非機能要件を定義する。
このサーバーは、SIPレジストラ、ステートフルプロキシとして機能し、ユーザー管理とセッション監視のためのWebインターフェースを提供する。

## 2. 機能要件

### 2.1. SIPレジストラ機能
- SIPクライアントからの`REGISTER`リクエストを処理できること。
- ユーザーのレコードアドレス（AOR）とコンタクトアドレスを紐付けて管理できること。
- `REGISTER`リクエストに対してダイジェスト認証を要求できること。

### 2.2. SIPプロキシ機能
- ステートフルプロキシとして動作し、SIPダイアログを管理できること。
- 同一ドメイン内の登録済みユーザー間で、`INVITE`、`ACK`、`BYE`などのSIPメソッドを中継できること。
- `Record-Route`ヘッダーを使用し、通話中のシグナリングパスに常駐すること。

### 2.3. 認証機能
- RFC2617およびRFC3261に準拠したSIPダイジェスト認証（MD5）を実装すること。
- `REGISTER`および`INVITE`リクエストに対して認証を要求すること。

### 2.4. Web UIによるユーザー管理
- 新規ユーザーを追加するためのWebインターフェースを提供すること。
- ユーザー名とパスワードを指定してユーザーを作成できること。
- ユーザーの認証情報（ダイジェスト認証用のHA1ハッシュなど）を安全に保存すること。
- 既存のユーザーとそのSIPレルムを一覧表示するWebインターフェースを提供すること。

### 2.5. Web UIによるセッション監視
- 現在アクティブなすべてのSIPセッション（通話）を一覧表示するWebページを提供すること。
- 各セッションについて、発信者、着信者、通話時間、SIP Call-IDを表示すること。
- セッションリストはリアルタイム、またはそれに近い形で更新されること。

### 2.6. 音声ガイダンスサービス
- 事前に設定された特定のユーザー名（例：`announcement`）への着信に応答できること。
- 応答後、事前に録音された音声ファイル（WAV形式）を発信者にストリーミング再生すること。
- メディアのストリーミングにはWebRTCを使用すること。

## 3. 非機能要件

### 3.1. プラットフォーム
- Go言語で実装されていること。
- Go 1.24以降のバージョンでビルドおよび実行が可能であること。

### 3.2. 依存性
- 外部ライブラリへの依存を最小限に抑えること。
- ユーザーおよび認証データはSQLiteデータベースに保存すること。
- CGoへの依存を避けるため、純粋なGoで実装されたSQLiteドライバを使用すること。
- 音声ガイダンス機能にはPion WebRTCライブラリを使用すること。

### 3.3. 設定
- サーバーの動作はコマンドラインフラグによって設定可能であること。
- 設定可能な項目には以下を含むこと:
  - Web UIの待受アドレスとポート
  - SIPサーバーの待受アドレスとポート
  - SQLiteデータベースファイルのパス
  - 認証用のSIPレルム
  - 音声ガイダンスサービス用のユーザー名

### 3.4. デプロイメント
- アプリケーションは単一のバイナリファイルとしてデプロイ可能であること。
